<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if is_edit %}Редактирование записи #{{ shipping_item.pk }}{% else %}Регистрация отправки{% endif %}</title>
    <link rel="stylesheet" href="/static/css/sendRegister.css">
    <script src="/static/js/sendRegister.js" defer></script>
</head>
<body>

{% if is_edit %}
<div style="text-align: center; margin: 20px 0;">
    <h1>Редактирование записи #{{ shipping_item.pk }}</h1>
    <p>Запись создана: {{ shipping_item.last_updated_status|date:"d.m.Y H:i" }}</p>
</div>
<div class="marketSelectBlock">
    <button id="ebay-button" class="selected-site" disabled>Ebay</button>
    <button id="other-site-button" disabled>Other Site</button>
</div>
{% else %}
<div class="marketSelectBlock">
    <button id="ebay-button" disabled>Ebay</button>
    <button id="other-site-button">Other Site</button>
</div>
{% endif %}


<!-- Отображение сообщений Django -->
{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div class="message {{ message.tags }}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<div id="form-container">
    <form id="purchase-ebay-form" action="{% if is_edit %}{% url 'edit_shipping_item' shipping_item.pk %}{% else %}{% url 'sendRegister' %}{% endif %}" method="POST">
        {% csrf_token %}
        <input type="hidden" name="status" value="{% if is_edit %}{{ shipping_item.status }}{% else %}КУПЛЕННО{% endif %}">
        <div class="floating-label-container">
            {{ form.number_announcement }}
            <label for="{{ form.number_announcement.id_for_label }}" class="floating-label">Номер объявления</label>
        </div>
        {{ form.number_announcement.errors }}
{#        <input type="number" name="announcemenet_number" placeholder="Номер объявления" maxlength="12" minlength="12">#}

<!--        Умный поиск по запросу-->
                <div class="auto-complete-container">
                    {{ form.smart }}
                    <div id="autoArticleComplete-list"></div>
                </div>
                {{ form.smart.errors }}
<!--        Умный поиск по запросу-->


        <div class="floating-label-container">  <!-- Новый класс для красивой стилизации label-->
            {{ form.country }}
            <label for="{{ form.country.id_for_label }}" class="floating-label">Страна</label>
        </div>
        {{ form.country.errors }}   <!-- Выводит ошибки в списке по этому полю (если есть)-->
{#        <input type="text" name="country" placeholder="Страна" value="США" >#}

        <div class="floating-label-container">
            {{ form.max_price }}
            <label for="{{ form.max_price.id_for_label }}" class="floating-label">Максимальная цена покупки</label>
        </div>
        {{ form.max_price.errors }}
{#        <input type="number" name="max_price" placeholder="Максимальная цена покупки" >#}

        <div class="floating-label-container">
            {{ form.priority }}
            <label for="{{ form.priority.id_for_label }}" class="floating-label">Приоритет</label>
        </div>
        {{ form.priority.errors }}

        <p>Выберите статус</p>
        <div class="status-buttons-container">
            <button type="button" class="status-button" data-option="form-buy">Куплено</button>
            <button type="button" class="status-button" data-option="form-massage">Написал</button>
            <button type="button" class="status-button" data-option="form-offer">Оффер</button>
        </div>
        <!--внутри purchase-ebay-form после кнопок-->
        <div id="form-buy" class="status-form hide-form">
            <div class="floating-label-container">
                {{ form.track_number }}
                <label for="{{ form.track_number.id_for_label }}" class="floating-label">Трек номер</label>
            </div>
            {{ form.track_number.errors }}

{#            <input type="text" name="trak" placeholder="трек номер" maxlength="100" minlength="10">#}

            <div class="floating-label-container">
                {{ form.date_arrive }}
                <label for="{{ form.date_arrive.id_for_label }}" class="floating-label">Дата прихода на склад</label>
            </div>
            {{ form.date_arrive.errors }}
{#            <input type="date" name="date_arrive" placeholder="дата прихода на склад">#}

            <div class="floating-label-container">
                {{ form.final_price }}
                <label for="{{ form.final_price.id_for_label }}" class="floating-label">Цена покупки с учетом доставки</label>
            </div>
            {{ form.final_price.errors }}
{#            <input type="number" name="" placeholder="цена покупки с учетом доставки">#}

        
            <div class="floating-label-container">
                {{ form.shipper }}
                <label for="{{ form.shipper.id_for_label }}" class="floating-label">Отправщик</label>
            </div>
            {{ form.shipper.errors }}
{#            <select name="shipper">#}
{#                {% for value, label in shipper_choices %}#}
{#                    <option value="{{ value }}">{{ label }}</option>#}
{#                {% endfor %}#}
{#            </select>#}
<!--            <input type="text" name="" placeholder="к кому отправлено">-->


            <div class="floating-label-container">
                {{ form.seller_name }}
                <label for="{{ form.seller_name.id_for_label }}" class="floating-label">Имя продавца</label>
            </div>
            {{ form.seller_name.errors }}
{#            <input type="text" name="" placeholder="имя продавца">#}
        
            <div class="floating-label-container">
                {{ form.shipping_type }}
                <label for="{{ form.shipping_type.id_for_label }}" class="floating-label">Тип доставки</label>
            </div>
            {{ form.shipping_type.errors }}
{#            <select name="type_delivery">#}
{#                <option value="AIR" selected>AIR</option>#}
{#                <option value="WATER">WATER</option>#}
{#            </select>#}

<!--            <input type="text" name="" placeholder="тип доставки">-->
        
            <div class="floating-label-container">
                {{ form.account_ebay }}
                <label for="{{ form.account_ebay.id_for_label }}" class="floating-label">{{ form.account_ebay.label }}</label>
            </div>
            {{ form.account_ebay.errors }}
{#            <select name="account_ebay">#}
{#                    {% for value, label in account_ebay_choices %}#}
{#                    <option value="{{ value }}">{{ label }}</option>#}
{#                {% endfor %}#}
{#            </select>#}
<!--            <input type="text" name="" placeholder="аккаунт ебей">-->

            
            <div class="floating-label-container">
                {{ form.overhead }}
                <label for="{{ form.overhead.id_for_label }}" class="floating-label">Дополнительные затраты</label>
            </div>
            {{ form.overhead.errors }}
            
            <div class="floating-label-container">
                {{ form.order_link }}
                <label for="{{ form.order_link.id_for_label }}" class="floating-label">Ссылка на заказ</label>
            </div>
            {{ form.order_link.errors }}
{#            <input type="text" name="" placeholder="доп затраты" value="0">#}
{#            <input type="text" name="" placeholder="ссылка на покупку">#}

            <div class="floating-label-container">
                {{ form.currency }}
                <label for="{{ form.currency.id_for_label }}" class="floating-label">{{ form.currency.label }}</label>
            </div>
{#            {{ form.currency }}#}
{#            <div class="floating-label-container">#}
{#                <select name="currency" id="currency-select">#}
{#                    <option value="USD" selected>USD</option>#}
{#                    <option value="EURO">EURO</option>#}
{#                </select>#}
{#                <label for="currency-select" class="floating-label">Валюта</label>#}
{#            </div>#}

<!--            <input type="text" name="" placeholder="валюта">-->
            <div class="floating-label-container">
                {{ form.comments }}
                <label for="{{ form.comments.id_for_label }}" class="floating-label">Дополнительный комментарий</label>
{#                <input type="text" name="comment" id="comment-input" placeholder="">#}
{#                <label for="comment-input" class="floating-label">Дополнительный комментарий</label>#}
            </div>
        </div>

        <div id="form-massage" class="status-form hide-form">
            <div class="floating-label-container">
                <textarea id="comments-mirror-massage" rows="4" cols="40"></textarea>
                <label for="comments-mirror-massage" class="floating-label">Дополнительный комментарий</label>
            </div>
        </div>

        <div id="form-offer" class="status-form hide-form">
            <div class="floating-label-container">
                <textarea id="comments-mirror-offer" rows="4" cols="40"></textarea>
                <label for="comments-mirror-offer" class="floating-label">Дополнительный комментарий</label>
            </div>
        </div>
        
        <div class="button-row">
            <div class="button-left">
                <button class="btn btn-clear" type="button" id="clear-form-btn">Очистить</button>
                {% if is_edit %}
                <a href="{% url 'delete_shipping_item' shipping_item.pk %}" class="btn btn-delete">Удалить</a>
                {% endif %}
            </div>
            <div class="button-right">
                <a href="{% url 'items' %}" class="btn btn-cancel">Отмена</a>
                <button class="btn" type="submit">{% if is_edit %}Сохранить{% else %}Отправить{% endif %}</button>
            </div>
        </div>
    </form>
    <form id="purchase-other-form" class="hide-form" action="/sellship/sendRegister/other-sites/" method="POST">
        <p>ПРИВЕТ КАК ДЕЛА</p>
    </form>
</div>

{% if form.errors %}
<script>
  window.location.hash = 'action=form-buy';
  restoreStateFromURL();
</script>
{% endif %}

{% if is_edit %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // В режиме редактирования по умолчанию выбираем "Куплено",
    // но если в URL уже есть #action=..., уважаем его
    setTimeout(function() {
        const hasActionHash = /#action=([^&]+)/.test(window.location.hash);
        if (!hasActionHash) {
            const statusButton = document.querySelector('[data-option="form-buy"]');
            if (statusButton) {
                statusButton.click();
            }
        }
    }, 100);
});
</script>
{% endif %}
</body>
</html>