{% load custom_filters %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏</title>
    <link rel="stylesheet" href="/static/css/items.css">
</head>
<body>
    <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏</h1>
    
    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
    <div class="theme-switcher">
        <button id="theme-toggle" class="theme-btn">
            <span class="theme-icon">üåô</span>
            <span class="theme-text">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</span>
        </button>
    </div>
    
    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="message {{ message.tags }}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
    
    <div class="filters">
        <!-- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
        <div class="filter-row">
            <div class="filter-group">
                <span class="filter-label">–°—Ç—Ä–∞–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</span>
                <a href="?{% if current_filters.shipper %}shipper={{ current_filters.shipper }}&{% endif %}{% if current_filters.status %}status={{ current_filters.status }}&{% endif %}{% if current_filters.priority %}priority={{ current_filters.priority }}&{% endif %}" 
                   class="filter-btn {% if not current_filters.country %}active{% endif %}">–í—Å–µ</a>
                {% for country_key, country_value in countries %}
                <a href="?country={{ country_key }}{% if current_filters.shipper %}&shipper={{ current_filters.shipper }}{% endif %}{% if current_filters.status %}&status={{ current_filters.status }}{% endif %}{% if current_filters.priority %}&priority={{ current_filters.priority }}{% endif %}" 
                   class="filter-btn {% if current_filters.country == country_key %}active{% endif %}">{{ country_value }}</a>
                {% endfor %}
            </div>
            <a href="{% url 'sendRegister' %}" class="filter-btn register-btn">‚ûï –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏</a>
        </div>
        
        <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
        <div class="filter-row">
            <div class="filter-group">
                <span class="filter-label">–°–∫–ª–∞–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏</span>
                <a href="?{% if current_filters.country %}country={{ current_filters.country }}&{% endif %}{% if current_filters.status %}status={{ current_filters.status }}&{% endif %}{% if current_filters.priority %}priority={{ current_filters.priority }}&{% endif %}" 
                   class="filter-btn {% if not current_filters.shipper %}active{% endif %}">–í—Å–µ</a>
                {% for shipper_key, shipper_value in shippers %}
                <a href="?{% if current_filters.country %}country={{ current_filters.country }}&{% endif %}shipper={{ shipper_key }}{% if current_filters.status %}&status={{ current_filters.status }}{% endif %}{% if current_filters.priority %}&priority={{ current_filters.priority }}{% endif %}" 
                   class="filter-btn {% if current_filters.shipper == shipper_key %}active{% endif %}">{{ shipper_value }}</a>
                {% endfor %}
            </div>
        </div>
        
        <!-- –¢—Ä–µ—Ç—å—è —Å—Ç—Ä–æ–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
        <div class="filter-row">
            <div class="filter-group">
                <span class="filter-label">–ú–∞–≥–∞–∑–∏–Ω</span>
                <a href="?{% if current_filters.country %}country={{ current_filters.country }}&{% endif %}{% if current_filters.shipper %}shipper={{ current_filters.shipper }}&{% endif %}{% if current_filters.status %}status={{ current_filters.status }}{% endif %}{% if current_filters.priority %}&priority={{ current_filters.priority }}{% endif %}" 
                   class="filter-btn {% if not current_filters.marketplace %}active{% endif %}">–í—Å–µ</a>
                <a href="?{% if current_filters.country %}country={{ current_filters.country }}&{% endif %}{% if current_filters.shipper %}shipper={{ current_filters.shipper }}&{% endif %}marketplace=ebay{% if current_filters.status %}&status={{ current_filters.status }}{% endif %}{% if current_filters.priority %}&priority={{ current_filters.priority }}{% endif %}" 
                   class="filter-btn {% if current_filters.marketplace == 'ebay' %}active{% endif %}">Ebay</a>
            </div>
        </div>
        
        <!-- –ß–µ—Ç–≤–µ—Ä—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
        <div class="filter-row">
            <div class="filter-group">
                <span class="filter-label">–°—Ç–∞—Ç—É—Å</span>
                <a href="?{% if current_filters.country %}country={{ current_filters.country }}&{% endif %}{% if current_filters.shipper %}shipper={{ current_filters.shipper }}&{% endif %}{% if current_filters.priority %}priority={{ current_filters.priority }}{% endif %}" 
                   class="filter-btn {% if not current_filters.status %}active{% endif %}">–í—Å–µ</a>
                {% for status_key, status_value in statuses %}
                <a href="?{% if current_filters.country %}country={{ current_filters.country }}&{% endif %}{% if current_filters.shipper %}shipper={{ current_filters.shipper }}&{% endif %}status={{ status_key }}{% if current_filters.priority %}&priority={{ current_filters.priority }}{% endif %}" 
                   class="filter-btn {% if current_filters.status == status_key %}active{% endif %}">{{ status_value }}</a>
                {% endfor %}
            </div>
        </div>
        
        <!-- –ü—è—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
        <div class="filter-row">
            <div class="filter-group">
                <span class="filter-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</span>
                <a href="?{% if current_filters.country %}country={{ current_filters.country }}&{% endif %}{% if current_filters.shipper %}shipper={{ current_filters.shipper }}&{% endif %}{% if current_filters.status %}status={{ current_filters.status }}{% endif %}" 
                   class="filter-btn {% if not current_filters.priority %}active{% endif %}">–í—Å–µ</a>
                {% for priority_key, priority_value in priorities %}
                <a href="?{% if current_filters.country %}country={{ current_filters.country }}&{% endif %}{% if current_filters.shipper %}shipper={{ current_filters.shipper }}&{% endif %}{% if current_filters.status %}status={{ current_filters.status }}{% endif %}&priority={{ priority_key }}" 
                   class="filter-btn {% if current_filters.priority == priority_key %}active{% endif %}">{{ priority_value }}</a>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π -->
    <div class="table-container">
        <table class="items-table">
            <thead>
                <tr>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                    <th>ID</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
                    <th>–£–¥–∞–ª–∏—Ç—å</th>
                </tr>
            </thead>
            <tbody>
                {% for item in shipping_items %}
                <tr class="{% if item.status == '–ó–ê–ö–†–´–¢–û' %}status-closed{% elif item.status == '–ó–ê–í–ï–†–®–ï–ù–û' %}status-completed{% elif item.status == '–ö–£–ü–õ–ï–ù–ù–û' %}status-purchased{% elif item.status == '–û–§–§–ï–†' %}status-offered{% elif item.status == '–ù–ê–ü–ò–°–ê–õ–ò' %}status-written{% elif item.status == '–°–û–ë–†–ê–ù–ù–û' %}status-collected{% elif item.status == '–û–®–ò–ë–ö–ò' %}status-mistakes{% endif %}">
                    <td>
                        <a href="{% url 'edit_shipping_item' item.pk %}{% if item.status == '–ö–£–ü–õ–ï–ù–ù–û' %}#action=form-buy{% elif item.status == '–ù–ê–ü–ò–°–ê–õ–ò' %}#action=form-massage{% elif item.status == '–û–§–§–ï–†' %}#action=form-offer{% endif %}" class="btn-action">üìù –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    </td>
                    <td>Ebay</td>
                    <td>{{ item.pk }}</td>
                    <td>{{ item.get_status_display }}</td>
                    <td>{{ item.get_priority_display }}</td>
                    <td>
                        <a href="{% url 'delete_shipping_item' item.pk %}" class="btn-action btn-delete">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="empty-state">
                        –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Ç—Ä–æ–∫—É
        document.querySelectorAll('.items-table tbody tr').forEach(row => {
            row.addEventListener('click', function(e) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∏–∫ –Ω–µ –ø–æ —Å—Å—ã–ª–∫–∞–º –¥–µ–π—Å—Ç–≤–∏–π
                const href = e.target.getAttribute && e.target.getAttribute('href');
                if (href && (href.includes('delete') || href.includes('edit'))) {
                    return; // –ø–æ–∑–≤–æ–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ
                }
                const cells = this.querySelectorAll('td');
                const itemId = cells[2].textContent.trim(); // ID –≤ —Ç—Ä–µ—Ç—å–µ–π –∫–æ–ª–æ–Ω–∫–µ
                const statusText = cells[3].textContent.trim(); // –°—Ç–∞—Ç—É—Å –≤ —á–µ—Ç–≤–µ—Ä—Ç–æ–π –∫–æ–ª–æ–Ω–∫–µ (display)
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ö—ç—à –ø–æ —Å—Ç–∞—Ç—É—Å—É
                let hash = '';
                if (statusText === '–ö–£–ü–õ–ï–ù–ù–û') hash = '#action=form-buy';
                else if (statusText === '–ù–ê–ü–ò–°–ê–õ–ò') hash = '#action=form-massage';
                else if (statusText === '–û–§–§–ï–†') hash = '#action=form-offer';
                // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ö—ç—à–µ–º
                window.location.href = '/sellship/items/edit/' + itemId + '/' + hash;
            });
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
            });
            
            btn.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = themeToggle.querySelector('.theme-icon');
        const themeText = themeToggle.querySelector('.theme-text');
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeButton(savedTheme);
        
        themeToggle.addEventListener('click', function() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
        });
        
        function updateThemeButton(theme) {
            if (theme === 'light') {
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
            } else {
                themeIcon.textContent = 'üåô';
                themeText.textContent = '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
            }
        }
    </script>
</body>
</html> 